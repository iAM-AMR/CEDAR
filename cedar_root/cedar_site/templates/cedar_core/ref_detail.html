{% extends 'base.html' %}

{% load static %}

{% load crispy_forms_tags %}

{% load widget_tweaks %}

{% block page_header %}
    {{ref.ref_title}}
{% endblock page_header %}

{% block head_css %}
  <!-- Your custom styles (optional) -->
  <link rel="stylesheet" href="{% static 'cedar_core/ref_detail_style.css' %}">
{% endblock head_css %}


{% block content %}
    <div class="container-fluid">

        <div class="row justify-content-center align-items-center">
            <div class="col-8">
                <h1 class="my-auto">Reference: {{ref.id}} | {{ref.key_bibtex}}</h1>
            </div>
            <div class="col-3">
                    <button type="button" id="openfactor">
                        <a href="{% url 'view_factors' ref_id=ref.id %}">Open Factor List</a>
                    </button>                
            </div>
        </div>

        <div class="row justify-content-center">
            <div class="col-11">
                <h3>{{ref.ref_title}}</h3>
                <hr class="mt-0 mb-4" style="border-width:5px;">
            </div>
        </div>

       

        <div class="row justify-content-center">
            <div class="col-11">

                <form action="" method="post" id="leadform" enctype="multipart/form-data" role="form">
                    {% csrf_token %}
                    
                    <nav>
                        <div class="nav nav-tabs" id="nav-tab" role="tablist">
                          <button class="nav-link active" id="nav-main-tab" data-bs-toggle="tab" data-bs-target="#main-md" type="button" role="tab" aria-controls="nav-main" aria-selected="true">Main</button>
                          <button class="nav-link" id="nav-study-design-tab" data-bs-toggle="tab" data-bs-target="#study-md" type="button" role="tab" aria-controls="nav-study-design" aria-selected="false">Study Design</button>
                          <button class="nav-link" id="nav-locale-tab" data-bs-toggle="tab" data-bs-target="#loc-md" type="button" role="tab" aria-controls="nav-locale" aria-selected="false">Locale</button>
                          <button class="nav-link" id="nav-notes-tab" data-bs-toggle="tab" data-bs-target="#notes-md" type="button" role="tab" aria-controls="nav-notes" aria-selected="false">Notes and Issues</button>
                          <button class="nav-link" id="nav-disabled-tab" data-bs-toggle="tab" data-bs-target="#nav-disabled" type="button" role="tab" aria-controls="nav-disabled" aria-selected="false" disabled>Disabled</button>
                        </div>
                      </nav>

                    <div class="tab-content card pt-2" id="myTabContentMD">
                        {% crispy ref_form ref_form_helper %}
                        <div class="tab-pane fade" id="loc-md" role="tabpanel" aria-labelledby="loc-tab-md">
                            <button type="button" class="btn btn-success btn-xs" id="addloc">
                                <a href="{% url 'add_new_obj' obj_id=ref.id form_type='loc' %}">Add Location</a>
                                <i class="fas fa-plus-square"></i>
                            </button>
                            <br><br>
                            {% crispy loc_formset loc_helper %}
                            <!-- {% for loc in loc_forms %}
                                {% crispy loc %}
                            {% endfor %} -->
                        </div>

                        <div class="tab-pane fade" id="notes-md" role="tabpanel" aria-labelledby="notes-tab-md">
                            <button type="button" class="btn btn-success btn-xs" id="addnote">
                                <a href="{% url 'add_new_obj' obj_id=ref.id form_type='note' %}">Add Note</a>
                                <i class="fas fa-plus-square"></i>
                            </button>
                            <br><br>
                            {% crispy note_formset note_helper %}
                            <!-- {% for f in note_forms %}
                                {% crispy f %}
                            {% endfor %} -->
                        </div>

                          
                          
                    </div>
                </form>
            </div>
        </div>
    </div>

{% endblock %}

{% block body_scripts %}

    <!-- On page reload, the tab currently active remains so -->
    <script>
        $(document).ready(function(){
            $('a[data-toggle="tab"]').on('show.bs.tab', function(e) {
                localStorage.setItem('activeTab', $(e.target).attr('href'));
            });
            var activeTab = localStorage.getItem('activeTab');
            if(activeTab){
                $('#myTabMD a[href="' + activeTab + '"]').tab('show');
            }
        });
    </script>

{% endblock body_scripts %}

{% block footer %}

    <script type="text/javascript" src="http://dal-yourlabs.rhcloud.com/static/collected/admin/js/vendor/jquery/jquery.js"></script>

    {{ ref_form.media }}

    <style>

        /* dal bootstrap css fix */
        .select2-container {
            width: 75% !important;
            min-width: 10em !important;
            right: -1px; /* adjusts spacing between prepended text and actual dropdown */
        }
        /* django-addanother bootstrap css fix */
        .related-widget-wrapper{
            /*padding-right: 0px; */
            position: relative;
            height: 10em;
            right: 20px;
        }
        .related-widget-wrapper-link{ /* the X button */
            position: relative;
            top: 3px;
            right: 50px;
        }

        span.select2-selection.select2-selection--single {
            height: 40px;
        }

        span.select2-selection__placeholder {
            font-size: 16px;
        }
    </style>

{% endblock %}